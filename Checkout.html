<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Paymob Payment</title>
</head>
<body>
  <h1>الدفع عن طريق Paymob</h1>
  <form id="paymob-payment-form">
    <label for="amount">المبلغ (بالجنيه المصري):</label>
    <input type="number" id="amount" placeholder="100.00" required>
    <br><br>
    <button type="submit">الدفع الآن</button>
  </form>

  <script>
    document.getElementById('paymob-payment-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const amount = document.getElementById('amount').value * 100; // تحويل المبلغ إلى قروش (مثلاً: 100 جنيه = 10000)
      const apiKey = 'ZXlKaGJHY2lPaUpJVXpVeE1pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SmpiR0Z6Y3lJNklrMWxjbU5vWVc1MElpd2ljSEp2Wm1sc1pWOXdheUk2T1RjMk1qZ3dMQ0p1WVcxbElqb2lhVzVwZEdsaGJDSjkuMk1QZFN6T3dJeGV5R3V4dnhTT3ZsdlJsX1Z0SVYxdkNzelN1ZFgtaEVLX09fdGk3bndBV19tRVJvU0R6Zk9RQjVZTm9USnMyLThpUzVZTy1PQjlFTVE='; // استبدل بـ API Key الخاص بك
      const integrationId = '4952483'; // استبدل بـ Integration ID الخاص بك

      try {
        // 1. طلب رمز المصادقة (Authentication Token)
        const authResponse = await fetch('https://accept.paymobsolutions.com/api/auth/tokens', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ api_key: apiKey })
        });
        const authData = await authResponse.json();
        const authToken = authData.token;

        // 2. إنشاء طلب الدفع
        const orderResponse = await fetch('https://accept.paymobsolutions.com/api/ecommerce/orders', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            auth_token: authToken,
            delivery_needed: "false",
            amount_cents: amount,
            currency: "EGP",
            items: []
          })
        });
        const orderData = await orderResponse.json();
        const orderId = orderData.id;

        // 3. طلب رابط الدفع
        const paymentKeyResponse = await fetch('https://accept.paymobsolutions.com/api/acceptance/payment_keys', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            auth_token: authToken,
            amount_cents: amount,
            expiration: 3600,
            order_id: orderId,
            billing_data: {
              first_name: "Ahmed",
              last_name: "Ali",
              email: "ahmed@example.com",
              phone_number: "01012345678",
              apartment: "1",
              floor: "1",
              street: "123 Street",
              building: "123",
              city: "Cairo",
              country: "EGY",
              postal_code: "12345"
            },
            integration_id: integrationId
          })
        });
        const paymentKeyData = await paymentKeyResponse.json();
        const paymentKey = paymentKeyData.token;

        // 4. إعادة التوجيه إلى صفحة الدفع
        window.location.href = `https://accept.paymobsolutions.com/api/acceptance/iframes/YOUR_IFRAME_ID?payment_token=${paymentKey}`;
      } catch (error) {
        console.error('Error:', error);
        alert('حدث خطأ أثناء معالجة الدفع.');
      }
    });
  </script>
</body>
</html>
